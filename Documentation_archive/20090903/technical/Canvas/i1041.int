========================================================================

File:      $RCSfile: i1041.int,v $
Version:   $Revision: 1.1 $
Modified:  $Date: 2009/09/03 18:18:56 $

(c) Copyright 2005-2009 by Mentor Graphics Corp. All rights reserved.

========================================================================
This document contains information proprietary and confidential to
Mentor Graphics Corp., and is not for external distribution.
========================================================================

Tiger Implementation Note
Fix subtype line model element identification

Abstract
--------
This node describes the changes to correct the model element identifier (ooa_id)
for the subtype connector.

History
-------

final i1041-061205-01.rvm

Document References
-------------------
Bugzilla Issue 1041

Background
----------
The issue describes the scenario to create the error.

Design
------
The Graphical Element (GD_GE) has an attribute OOA_ID that identifies the 
Model Element that the graphical element is associated with.  In the case of
a line connecting a subtype to the supertype line, the associated Model Element
is a Class As Subtype.  The value of Class As Subtype.Obj_ID was used as the 
value for GD_GE.OOA_ID, but in the case when a class is a subtype for multiple
supertypes, this is not a unique identifier.  The result being that the incorrect
Class As Subtype instance is associated with a subtype line.  The Class As 
Subtype.OIR_ID attribute is a unique identifier, and we make the changes to
use it.

1. Change Class As Subtype ooa_id value

The operation Class As Subtype.get_ooa_id() is changed to return the OIR_ID
attribute value instead of the Obj_id attribute.

2. Change import code

When importing a model from BP 6.1, the function fixUpGraphicalData() is called
to convert the data to the BP 7.0 format.  The code that fixes the subtype
line data is changed to call Class As Subtype.get_ooa_id() to get the correct
value for the GD_GE.OOA_ID.  This is generated by gen_import_java.inc.

3. Change instance resolution code

The bridge Cl_c.Getinstancefromooa_id() is changed to call Class As 
Subtype.get_ooa_id() when searching for an instance of Class As Subtype that 
matches the passed in ooa_id.

Implementation Comments
-----------------------

All currently existing models in the workspace need to be updated to use the
correct id value.   This is done by creating a function 
fixupSubtypeConnectorOoaId() that finds the correct OIR_ID and updates the
GD_GE.OOA_ID value.  The ImportModel class is modified to invoke this function
just before invoking setGraphicalRepresents().  This modified class is then 
used to import each xtuml model.  We then cause the model to be exported with
the corrected values.

To be consistent with the Class As Subtype code, the Class As Link import fixup
and instance resolution code are changed to use get_ooa_id() instead of 
getRel_id() (which is what get_ooa_id() returns).

Unit Test
---------

- The unit test MultipleSupertypeTest is added to the ui.canvas.test.  It tests
that when selecting a subtype line for a class with multiple supertypes that 
only one subtype line is selected.  There is a second test for when the subtype
is an imported class.

Code Changes
------------

com.mentor.nucleus.bp.core/models/ooaofooa.xtuml
com.mentor.nucleus.bp.io.core/arc/gen_import_java.inc
com.mentor.nucleus.bp.ui.canvas/src/com/mentor/nucleus/bp/ui/canvas/Cl_c.java

com.mentor.nucleus.bp.internal.io.sql.test/expected_results/cme1.imp
com.mentor.nucleus.bp.internal.io.sql.test/expected_results/oal_function1.exp

com.mentor.nucleus.bp.io.mdl.test/expected_results/odms.imp

com.mentor.nucleus.bp.io.sql.test/expected_results/odms.imp

com.mentor.nucleus.bp.ui.canvas.test/expected_results/MultipleSupertypeTest_1/* [added]
com.mentor.nucleus.bp.ui.canvas.test/expected_results/MultipleSupertypeTest_2/* [added]
com.mentor.nucleus.bp.ui.canvas.test/models/MultipleSupertypeTest.xtuml [added]
com.mentor.nucleus.bp.ui.canvas.test/src/CanvasTestSuite.java
com.mentor.nucleus.bp.ui.canvas.test/src/com/mentor/nucleus/bp/ui/canvas/test/
     CanvasTestResultCreator.java
com.mentor.nucleus.bp.ui.canvas.test/src/com/mentor/nucleus/bp/ui/canvas/test/
     MultipleSupertypeTest.java [added]
     
Models updated:

com.mentor.nucleus.bp.als/models/grammar.xtuml

com.mentor.nucleus.bp.als.oal.test/models/testOAL1.xtuml

com.mentor.nucleus.bp.compare.test/models/diffModel_one.xtuml
com.mentor.nucleus.bp.compare.test/models/diffModel_two.xtuml
com.mentor.nucleus.bp.compare.test/models/sameModel_one.xtuml
com.mentor.nucleus.bp.compare.test/models/sameModel_two.xtuml

com.mentor.nucleus.bp.core.test/models/AttributeMenuItemTests.xtuml
com.mentor.nucleus.bp.core.test/models/DeleteTestModel.xtuml
com.mentor.nucleus.bp.core.test/models/FormalizeUnformalizeTests.xtuml
com.mentor.nucleus.bp.core.test/models/odms.xtuml
com.mentor.nucleus.bp.core.test/models/subtypeSupertypeFormalizeTest.xtuml
com.mentor.nucleus.bp.core.test/models/testRename1.xtuml

com.mentor.nucleus.bp.io.core/models/file_io.xtuml

com.mentor.nucleus.bp.io.mdl.test/expected_results/models/br1.xtuml
com.mentor.nucleus.bp.io.mdl.test/expected_results/models/br1f.xtuml
com.mentor.nucleus.bp.io.mdl.test/expected_results/models/br2.xtuml
com.mentor.nucleus.bp.io.mdl.test/expected_results/models/br2f.xtuml
com.mentor.nucleus.bp.io.mdl.test/expected_results/models/G_ALL_nested_invoke.xtuml
com.mentor.nucleus.bp.io.mdl.test/expected_results/models/G_EVT_PE_G_EVT_NLE_nle_ignored.xtuml
com.mentor.nucleus.bp.io.mdl.test/expected_results/models/G_IOP_MDA_self_event.xtuml
com.mentor.nucleus.bp.io.mdl.test/expected_results/models/G_STE_G_EVT_PE_to_creation.xtuml
com.mentor.nucleus.bp.io.mdl.test/expected_results/models/G_STE_G_STE_pe_le_same_state.xtuml
com.mentor.nucleus.bp.io.mdl.test/expected_results/models/im2.xtuml
com.mentor.nucleus.bp.io.mdl.test/expected_results/models/im4.xtuml
com.mentor.nucleus.bp.io.mdl.test/expected_results/models/odms.xtuml
com.mentor.nucleus.bp.io.mdl.test/expected_results/models/ooaofooa.xtuml
com.mentor.nucleus.bp.io.mdl.test/expected_results/models/poly.xtuml
com.mentor.nucleus.bp.io.mdl.test/expected_results/models/wim2.xtuml
com.mentor.nucleus.bp.io.mdl.test/expected_results/odms.xtuml
com.mentor.nucleus.bp.io.mdl.test/models/odms.xtuml
com.mentor.nucleus.bp.io.mdl.test/models/unicode.xtuml

com.mentor.nucleus.bp.pkg/sample-models/odms.xtuml
com.mentor.nucleus.bp.pkg/sample-models/metamodel.xtuml

com.mentor.nucleus.bp.ui.canvas/models/ooaofgraphics.xtuml

com.mentor.nucleus.bp.ui.canvas.test/models/odms.xtuml
com.mentor.nucleus.bp.ui.canvas.test/models/odms_518.xtuml
com.mentor.nucleus.bp.ui.canvas.test/models/ooaofooa.xtuml

com.mentor.nucleus.bp.ui.properties.test/models/testProp.xtuml

End
---

$Log: i1041.int,v $
Revision 1.1  2009/09/03 18:18:56  rmulvey
job:dts0100616734
Archive documentation and other development notes following the R3_0_0 release.  These are being archived under Documentation/internal/technical/archive/20090903

Revision 1.4  2009/01/01 23:13:05  rmulvey
Job:4060
Batch promotion of copyright changes from Review-i4060 and Review-i4060-01.

Revision 1.3.30.1  2008/12/31 16:10:08  rmulvey
Job:4060
This is a batch commit of 2009 copyright changes to branch Review-i4060.  This includes the
report that outlines all changes made (before/after for each line changed).  This report is found here: <cvs>/Documentation/internal/test_results/R2_1_2/i4060/update-copyright-results.txt.

Revision 1.3  2005/06/12 21:37:03  greg
Job: 1041
Add history, fix typo

Revision 1.2  2005/06/12 18:00:51  greg
Job: 1041
Ready for review

Revision 1.1  2005/06/11 20:26:48  greg
Job: 1041
Introduce
