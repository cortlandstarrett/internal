========================================================================

File:      $RCSfile: dts0100875414.int,v $
Version:   $Revision: 1991 $
Modified:  $Date: 2012-11-02 14:29:43 -0700 (Fri, 02 Nov 2012) $

(c) Copyright 2007-2012 by Mentor Graphics Corp. All rights reserved.

========================================================================
This document contains information proprietary and confidential to
Mentor Graphics Corp., and is not for external distribution.
========================================================================

BridgePoint Project Implementation Note
Export referred to systems in pre-builder


1. Abstract
-----------
The file output by pre-builder does not contain all the required information
for models that use inter-project references.  A fix is detailed in this note.

2. History
----------

3. Document References
----------------------
[1] ClearQuest DEI dts0100875414
[2] ClearQuest DEI dts0100843233 - Update the pre-builder to work with 
      inter-project references
[3] <SVN>/trunk/AE/customers/Medtronic/mdt_vp/ - Folder containing Medtronic
      virtual platform models
[4] ClearQuest DEI dts0100884270 - Test pre-builder preferences

4. Background
-------------
When a project pulls in an interface via IPR (like Medtronic does), the 
<system>.sql file that is generated by pre-builder just has proxies for the 
interfaces and executable properties.  This is not enough information for the 
model compiler.  

This issue details changes to the pre-builder output file to make it contain all
the relevant info from the referred to system so the model compiler can operate 
properly.

This issue is kind of a subset of [2], but that issue proposes a number features
and enhancements that are not handled here.  This issue is a baby step enhance-
ment to keep the SystemC model compiler development going in support of 
Medtronic and other customers that implement their own model compilers and need
the extended dataset as well.

5. Requirements
---------------
5.1  Pre-builder must be able to emit all the model data from referred-to 
       projects.
       
5.2  The pre-builder output for all the projects will go into a single file:
       <project>/gen/code_generation/<project>.sql where <project> = the 
       original project the eclipse build command was invoked on.
       
5.3  Carry-in requirement from [2]: A preference "Emit referred to model 
       elements in other projects" shall be offered on a per project basis. This
       preference shall be shown in the user interface close to the model 
       compiler builder preferences.  A workspace level preference shall define 
       a default value for the project level preference required above. The 
       default installation setting for this shall be 'true'. Both workspace 
       level and project level preferences shall be persistent.

6. Work Required
----------------
6.1  Preferences
6.1.1  Add new page in the BridgePoint workspace preferences named 
       "Build / Translation".  The page will contain a checkbox for the pref-
       erence called out in 5.3.  The default is true.
6.1.2  Requirement 5.3 states that: "This preference shall be shown in the user
       interface close to the model compiler builder preferences."  It was 
       decided in engineering discussion that the preference will instead be put
       in the existing Project preferences page next to the project IPR enable-
       ment setting. 
6.1.3  Enhance the BridgePoint preference infrastructure (model and store) to 
       persist the new workspace and project preference settings.

6.2  Pre-builder change
6.2.1  If the stream export has any proxies to write out, look at each one and 
       record what systems/projects they belong to.  Create an accessor function
       for clients to retrieve this list after the export has finished.
6.2.2  Change the stream export such that component references are exported as 
       proxies in the original project data instead of sucking in all the real 
       data from the imported component.  This way there won't be duplicate data
       in the output when the preference to "emit all rto data" is turned on.
6.2.3  After the pre-builder exports the data for the system being built, find 
       out if there were any proxies that refer to other systems.  If there 
       were, export those systems into the same output file as well.
6.2.4  The export of RTO systems will use a recursive call to the pre-builder.
       This means that RTO systems will be parsed and exported just like the 
       original system the build was invoked on.  Thus, if a referred to system
       also refers to another system, they will all be included in the original
       output.
6.2.5  The preference settings will control whether the referred to systems are
       processed.  If the preference is turned off, only the system originally
       being built will be output by pre-builder.  The project preference will 
       take precedence if it exists.  If the preference is not set on the 
       project, the current workspace setting will be used.
6.2.6  Note that the xtumlmc_build process strips out all proxies during the 
       step where the model files is "cleansed" and UUIDs are converted to ints.
       
6.3 Fall out changes
6.3.1  Modify the build server build scripts to change the ordering of where the
       bp.utilities plug-in is built.  It must be after bp.mc.mc3020 but before 
       bp.mc.  The bp.mc plugin depends on bp.utilities now, but bp.utilities 
       depends on bp.mc.mc3020, so we had to get the ordering right.
     
7. Implementation Comments
--------------------------
7.1  During implementation, an unused transient was found and removed in the 
     Verifier preference code.

8. Unit Test
------------
8.1  Existing JUnit tests cases must pass

8.2  Test workspace preference persistence.
  ## Note this test is captured in [4]
  ## This test checks that the workspace setting is persisted both in checked
  ## and unchecked form.
  _- Open a new workspace
  _- Open Window > Preferences > BridgePoint > Build / Translation
  _R The "Emit referred to..." checkbox is checked
  _- Exit BridgePoint
  _- Start BridgePoint on the previous workspace
  _- Open Window > Preferences > BridgePoint > Build / Translation
  _R The "Emit referred to..." checkbox is checked
  _- Click it to uncheck the box
  ## Here we make sure that Restore Defaults sets the workspace setting back to 
  ## true.
  _- Click Restore Defaults button
  _R The "Emit referred to..." checkbox is checked
  _- Click it to uncheck the box
  _- Click OK to close the dialog
  _- Exit BridgePoint
  _- Start BridgePoint on the previous workspace
  _- Open Window > Preferences > BridgePoint > Build / Translation
  _R The "Emit referred to..." checkbox is unchecked

8.3  Test project preference persistence
  ## Note this test is captured in [4]
  ## This test sequence makes sure that the project preference is persisted
  ## properly.
  _- Open a workspace
  _- Create a new xtUML Project "A"
  _- Create a new xtUML Project "B"
  _- Open Window > Preferences > BridgePoint > Build / Translation
  _- Verify the "Emit referred to..." checkbox is checked
  _- Close the dialog using OK
  # Now that we have our test projects, modify the setting on project A.  Here
  # we test that it defaulted to the workspace setting.
  _- Right click on the project A and select Project Preferences
  _- The "Emit referred to..." checkbox is checked
  _- Click the "Emit referred to..." checkbox to uncheck it
  _- Close the dialog using OK
  # Chage the workspace default to "off"
  _- Open Window > Preferences > BridgePoint > Build / Translation
  _- Click the "Emit referred to..." checkbox to uncheck it
  _- Close the dialog using OK
  # Now check that project B defaults to the "off" setting, but don't persist
  # the preference for project B
  _- Right click on the project B and select Project Preferences
  _- The "Emit referred to..." checkbox is unchecked
  _- Close the dialog using Cancel
  _- Exit BridgePoint
  # Now we check the persisted value for Project A, then change it to "on"
  _- Start BridgePoint on the previous workspace
  _- Right click on the project A and select Project Preferences
  _- The "Emit referred to..." checkbox is unchecked
  _- Check it
  _- Close the dialog using OK
  # Next we check that Project B still matches the workspace default
  _- Right click on the project B and select Project Preferences
  _- The "Emit referred to..." checkbox is unchecked
  _- Close the dialog using Cancel
  _- Exit BridgePoint
  _- Start BridgePoint on the previous workspace
  # Again we check Project A persisted the preference right
  _- Right click on the project A and select Project Preferences
  _- The "Emit referred to..." checkbox is checked
  _- Close the dialog using OK
  # B should still default to the workspace default.  Check that the restore 
  # defaults button sets the value to the current workspace setting.  Test both
  # cases, workspace setting "off" and workspace setting "on". 
  _- Right click on the project B and select Project Preferences
  _- The "Emit referred to..." checkbox is unchecked
  _- Check it
  _- Click "Restore Defaults"
  _R The "Emit referred to..." checkbox becomes unchecked
  _- Close the dialog using Cancel
  _- Open Window > Preferences > BridgePoint > Build / Translation
  _- Click the "Emit referred to..." checkbox to check it
  _- Close the dialog using OK
  _- Right click on the project B and select Project Preferences
  _- The "Emit referred to..." checkbox is checked
  _- Click it to uncheck
  _- Click "Restore Defaults"
  _R The "Emit referred to..." checkbox becomes checked
  _- Close the dialog using Cancel
  
8.4  Pre-builder output test

W = workspace setting "Emit referred to model elements in other projects"
  W1 = true
  W2 = false
  
P = project setting "Emit referred to model elements in other projects"
  P1 = true
  P2 = false
  P3 = unset
  
Expected results:
  R1 = Output <project>/gen/code_generation/<project.sql> contains more than one 
       S_SYS insert
  R2 = Output <project>/gen/code_generation/<project.sql> contains only one 
       S_SYS insert for <project>
        
     P1    P2   P3
W1   R1    R2   R1
W2   R1    R2   R2

8.4.1  How to set up the test:
  _- Open a workspace
  _- Explore SVN, pull down all the models under [3]
  _- Open Project Properties for EGM and Activity.  For each, go to the builders
     and turn off all builders except "Model Compiler Pre-Build"

8.4.2  Running the test:
  _- Use EGM for P1 and P2 scenarios, Activity for P3
  _- Manipulate the workspace and project settings for EGM to test the P1 and
     P2 columns, building the project and inspecting the pre-builder output SQL
     file finding results to match the table
  _- Manipulate the workspace setting and Activity to test the P3 column, 
     building the project and inspecting the pre-builder output SQL file finding
     results to match the table

9. Code Changes
---------------
Branch name: Review-dts0100875414

com.mentor.nucleus.bp.core/src/com.mentor.nucleus.bp.core.common/
    BridgePointPreferencesModel.java
com.mentor.nucleus.bp.core/src/com.mentor.nucleus.bp.core.common/
    BridgePointPreferencesStore.java
com.mentor.nucleus.bp.core/src/com.mentor.nucleus.bp.core.ui.preferences/
    BridgePointProjectPreferences.java
com.mentor.nucleus.bp.core/src/com.mentor.nucleus.bp.core.ui.preferences/
    BuildTranslationPreferences.java
com.mentor.nucleus.bp.core/src/com.mentor.nucleus.bp.core.ui.preferences/
    VerifierPreferences.java
com.mentor.nucleus.bp.core/arc/create_core_plugin.inc
com.mentor.nucleus.bp.core/tools/create_release_functions.sh
com.mentor.nucleus.bp.core/generate.xml

com.mentor.nucleus.bp.io.core/src/com.mentor.nucleus.bp.io.core/CoreExport.java
com.mentor.nucleus.bp.io.core/arc/export_functions.inc

com.mentor.nucleus.bp.io.mdl/arc/gen_stream_export.arc
com.mentor.nucleus.bp.io.mdl/sql/stream.pei.sql

com.mentor.nucleus.bp.mc/src/com.mentor.nucleus.bp.mc/AbstractExportBuilder.java
com.mentor.nucleus.bp.mc/META-INF/MANIFEST.MF
com.mentor.nucleus.bp.mc/generate.xml

com.mentor.nucleus.bp.mc.mc3020/src/com.mentor.nucleus.bp.mc.mc3020/
    ExportBuilder.java
com.mentor.nucleus.bp.mc.mc3020/generate.xml
com.mentor.nucleus.bp.mc.mc3020/plugin.xml



End
---

$Log: dts0100875414.int,v $
Revision 1.6  2012/04/23 20:52:13  kbrown
job:dts0100875414
Completing paperwork.

Revision 1.5  2012/04/23 20:38:11  kbrown
job:dts0100875414
Tieing up review minutes.

Revision 1.4  2012/04/19 21:45:48  kbrown
job:dts0100875414
Updated INT.

Revision 1.3  2012/04/19 21:34:52  kbrown
job:dts0100875414
Updated INT.

Revision 1.2  2012/04/18 14:33:58  kbrown
job:dts0100875414
Address some pre-review comments.

Revision 1.1  2012/04/17 20:55:10  kbrown
job:dts0100875414
Completed first draft of INT.
